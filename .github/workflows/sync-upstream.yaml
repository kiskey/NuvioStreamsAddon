name: Sync Fork with Upstream

on:
  schedule:
    # Run every day at midnight PST (UTC-8)
    # The cron string is in UTC. Midnight PST is 8 AM UTC.
    - cron: '0 8 * * *'
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure Git user
        run: |
          git config user.email "actions@github.com"
          git config user.name "GitHub Actions"

      - name: Add upstream remote
        run: git remote add upstream ${{ env.UPSTREAM_REPO }}
        env:
          UPSTREAM_REPO: https://github.com/tapframe/NuvioStreamsAddon.git

      - name: Fetch upstream branches
        run: git fetch upstream

      # --- THIS IS THE KEY MODIFIED STEP ---
      - name: Merge upstream and resolve conflicts
        run: |
          # Attempt the merge, using the 'theirs' option to auto-resolve conflicts
          # The .gitattributes file will ensure 'Dockerfile' uses the 'ours' strategy
          git merge --no-edit -X theirs upstream/master

      - name: Push changes to fork
        run: git push origin master
